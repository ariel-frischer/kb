releases:
  - version: "unreleased"
    date: null
    added: []
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: []

  - version: "1.2.0"
    date: "2026-02-17"
    summary: "Adds local embedding backend for fully offline indexing and search with no API cost. Default local model switched to ibm-granite/granite-embedding-english-r2 (149M, ModernBERT) for better retrieval quality. Also introduces feedback submission for agents via CLI and MCP."
    added:
      - description: "`kb feedback` CLI command and `kb_feedback` MCP tool for agents to submit bug reports, suggestions, and notes (appends to `~/.local/share/kb/feedback.yml`)"
        commits: ["9827095"]
      - description: "Local embedding backend (sentence-transformers) — set `embed_method = \"local\"` for fully offline indexing and search with no API cost. Supports Matryoshka dimension truncation and GPU acceleration"
        commits: ["7d279b6"]
      - description: "`local-embed` optional extra (`sentence-transformers>=3.0`) for local embeddings"
        commits: ["7d279b6"]
      - description: "Auto-detect local model embedding dimensions — `local_embed_dims(cfg)` prevents vec0 dimension mismatch when switching from OpenAI defaults, while preserving Matryoshka truncation"
        commits: ["517fa61"]
    fixed: []
    changed:
      - description: "Default local embed model switched from `Snowflake/snowflake-arctic-embed-m-v1.5` (109M, BERT) to `ibm-granite/granite-embedding-english-r2` (149M, ModernBERT, +4 NDCG@10 points)"
        commits: ["517fa61"]
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.1.0"
    date: "2026-02-17"
    summary: "Major search quality release. Adds HyDE best-of-two for smarter vector retrieval, optional query expansion (local FLAN-T5 or LLM), FTS-only keyword search, and an MCP server for AI agent integration. Fixes vec0 distance metric (cosine instead of L2) and tag filtering (now SQL-level pre-filtering). Includes configurable BM25 shortcut thresholds and FTS5 field-weighted BM25 with truncated paths to avoid IDF collapse."
    added:
      - description: "Configurable BM25 shortcut thresholds (`bm25_shortcut_min`, `bm25_shortcut_gap`) for ask mode"
        commits: []
      - description: "Query expansion — generates keyword synonyms (FTS) and semantic rephrasings (vector) via local FLAN-T5 or LLM, fuses with multi-list weighted RRF (`--expand` / `--no-expand`)"
        commits: ["e04c35f", "a00068b"]
      - description: "HyDE (Hypothetical Document Embeddings) — generates a hypothetical answer passage before vector search for improved retrieval on question-style queries"
        commits: ["59fadc9", "a00068b"]
      - description: "Local HyDE generation via transformers (Qwen/Qwen3-0.6B default) — no API cost alternative to LLM-based HyDE (`hyde_method = \"local\"`)"
        commits: []
      - description: "`local-llm` optional extra (transformers + torch) for local HyDE generation"
        commits: []
      - description: "FTS-only keyword search command (`kb fts`) for fast, no-API searches"
        commits: ["2bfe417"]
      - description: "Positional rank bonuses in RRF fusion scoring"
        commits: ["2bfe417"]
      - description: "`--json` flag for `kb search` and `kb ask` structured output"
        commits: ["cce0a74"]
      - description: "FTS5 trigger-based sync with porter stemming tokenizer"
        commits: ["cce0a74", "5b145f1"]
      - description: "FTS5 field weighting — fts_path (10x), heading (2x), text (1x) via weighted BM25 rank config. fts_path stores last 2 path components to avoid IDF collapse"
        commits: ["62e9c21"]
      - description: "HyDE best-of-two — embeds both raw query and HyDE passage, keeps whichever vec result set has better top-1 similarity (HyDE can only help, never hurt)"
        commits: ["62e9c21"]
      - description: "Tag SQL-level pre-retrieval filtering — `run_fts_query_filtered()` uses `AND rowid IN (ids)`, `run_vec_query_filtered()` uses `vec_distance_cosine()`, ensuring tagged docs are found regardless of global ranking"
        commits: ["62e9c21"]
      - description: "MCP server exposing search/ask/fts/similar/status/list tools for AI agents"
        commits: ["5b145f1", "5d35d92"]
      - description: "Core API module (`api.py`) separating logic from CLI presentation"
        commits: ["5b145f1"]
    fixed:
      - description: "Vec0 now uses cosine distance — previously L2 distance caused `1 - distance` to produce negative similarity, breaking vector search entirely (schema v8→v9, requires reindex)"
        commits: []
      - description: "`kb ask --json` now includes `rerank`, `filters`, `result_count`, `filtered_count` keys (were present in api.py but omitted by cli.py)"
        commits: []
      - description: "Tag filter now uses SQL-level pre-filtering — `run_fts_query_filtered()` adds `AND rowid IN (tagged_ids)` to FTS WHERE clause, `run_vec_query_filtered()` uses `vec_distance_cosine()` for tagged chunks only. Previously filtered Python result lists after SQL returned global top-k, which missed tagged docs entirely"
        commits: []
      - description: "BM25 shortcut gap threshold lowered from 0.15 to 0.02 — matches real-world corpus gaps of ~0.022 (configurable via `bm25_shortcut_gap`)"
        commits: []
      - description: "HyDE no longer hurts vec search — best-of-two approach keeps raw query results when HyDE passage is off-domain"
        commits: ["62e9c21"]
      - description: "BM25 shortcut in ask now deduplicates by document before gap check (LIMIT 20, group by doc_path) — shortcut can actually fire"
        commits: ["62e9c21"]
      - description: "Fused candidate count now captured pre-filter; `after_filters` key added when filters active"
        commits: ["62e9c21"]
      - description: "Common path terms (e.g. project name in every doc_path) no longer get zero FTS weight — fts_path stores last 2 path components"
        commits: ["62e9c21"]
      - description: "RRF fusion rank bonus application for accurate scoring"
        commits: ["6484412"]
      - description: "FTS escape to use AND queries with prefix matching"
        commits: ["5b145f1"]
      - description: "Enable WAL mode and foreign keys for better DB performance"
        commits: ["5b145f1"]
    changed:
      - description: "Project-mode DB moved to XDG data dir (`~/.local/share/kb/projects/<hash>/kb.db`) — no database files in project directory, WAL sidecar files no longer appear in git status"
        commits: []
      - description: "`kb init --project` no longer creates `.kb/` directory or `.gitignore`"
        commits: []
      - description: "`kb reset` now cleans up WAL sidecar files (`.db-shm`, `.db-wal`)"
        commits: []
      - description: "Schema version upgraded from 4 to 9 (FTS triggers + porter tokenizer + field weighting + fts_path truncation + cosine distance)"
        commits: ["cce0a74", "5b145f1", "62e9c21"]
      - description: "CLI refactored to thin wrappers over `api.py` core functions"
        commits: ["5b145f1"]
      - description: "BM25 shortcut in ask skips embedding/vector/rerank when FTS results are high-confidence"
        commits: ["2bfe417"]
    removed: []
    deprecated: []
    breaking: []
    migration: "Schema auto-migrates from v4→v5→v6→v7→v8→v9. v8→v9 switches vec0 to cosine distance (drops vec_chunks, reindex required via `kb index`). v7→v8 adds fts_path column (last 2 path components) and rebuilds FTS using truncated paths. v6→v7 adds doc_path column to chunks and rebuilds FTS with 3-column weighted BM25."
    contributors: ["ariel-frischer"]

  - version: "1.0.8"
    date: "2026-02-16"
    added:
      - description: "Show relevant snippet centered on query matches in search results"
        commits: ["17f89a3"]
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.7"
    date: "2026-02-16"
    changed:
      - description: "Split `threshold` into `search_threshold` and `ask_threshold` for independent tuning"
        commits: ["e3b942f"]
    added: []
    fixed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.6"
    date: "2026-02-16"
    fixed:
      - description: "Default threshold changed from 0.25 to 0.001 for more inclusive results"
        commits: ["a636bc2"]
      - description: "Apply threshold after top_k to reduce results instead of backfilling"
        commits: ["6eb0fcb"]
    added: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.5"
    date: "2026-02-16"
    added:
      - description: "`--threshold` flag for `kb search` command"
        commits: ["802f959"]
    changed:
      - description: "Rename `min_similarity` config key to `threshold`"
        commits: ["802f959"]
    fixed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.4"
    date: "2026-02-16"
    added:
      - description: "Version command (`kb version`, `kb v`, `kb --version`)"
        commits: ["38056fc", "4a66a3c"]
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.3"
    date: "2026-02-16"
    added:
      - description: "`--threshold` parameter for `kb ask` command"
        commits: ["49b85a1"]
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.2"
    date: "2026-02-16"
    added:
      - description: "Per-subcommand `-h`/`--help` support"
        commits: ["77c1435"]
      - description: "Show model name in `kb ask` output"
        commits: ["77c1435"]
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.1"
    date: "2026-02-16"
    fixed:
      - description: "Zsh completion function updated to use `compdef` for better compatibility"
        commits: ["06bb17f"]
    added: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]

  - version: "1.0.0"
    date: "2026-02-16"
    added:
      - description: "CLI knowledge base tool with hybrid search (sqlite-vec + FTS5) and RAG answers"
        commits: ["ea927ee"]
      - description: "Support for 30+ document formats (markdown, PDF, DOCX, EPUB, HTML, ODT, RTF, plain text, email, subtitles, and more)"
        commits: ["bba0458"]
      - description: "Document tagging with auto-extraction from markdown YAML frontmatter"
        commits: ["0ad42bb"]
      - description: "Similar document search via embedding averaging"
        commits: ["0ad42bb"]
      - description: "`.kbignore` pattern support for file filtering"
        commits: ["6112327"]
      - description: "Global and project-local scope modes with config walk-up"
        commits: ["894143e"]
      - description: "`kb list` command with `--full` detailed output"
        commits: ["4cc54fb"]
      - description: "Inline filter syntax (`file:`, `type:`, `tag:`, `dt>`, `dt<`, `+\"kw\"`, `-\"kw\"`)"
        commits: ["0ad42bb"]
      - description: "GitHub Actions CI and release workflows"
        commits: ["86c4c24", "ea927ee"]
      - description: "Makefile for project management and development commands"
        commits: ["d30c381"]
      - description: "MIT license"
        commits: ["86c4c24"]
    fixed: []
    changed: []
    removed: []
    deprecated: []
    breaking: []
    migration: null
    contributors: ["ariel-frischer"]
